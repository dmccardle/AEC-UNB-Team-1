<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='materialize.min.css') }}">
    <link rel='stylesheet' type="text/css" href="{{ url_for('static', filename='fullcalendar.min.css') }}">

    <meta charset="UTF-8">
    <title>Title</title>
</head>



<body>
<div id="calendar" style="width: 65%; margin:auto"></div>
<script src="{{ url_for('static', filename='materialize.min.js') }}"></script>
<script src="{{ url_for('static', filename='jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='moment.min.js') }}"></script>
<script src="{{ url_for('static', filename='fullcalendar.min.js') }}"></script>

<script type="text/javascript">
    $(document).ready(function() {
        $('#calendar').fullCalendar({
            header: {
                left: 'month,agendaWeek,agendaDay,list',
                center: 'addEventButton',
                right: 'prev,next',
            },
            footer: {
                left: '',
                center: '',
                right: ''
            },
            customButtons: {
                addEventButton: {
                    text: 'add event...',
                    click: function() {
                        var dateStr = prompt('Enter a date in YYYY-MM-DD format');
                        var date = moment(dateStr);

                        if (date.isValid()) {
                            var event = {
                                        title: 'dynamic event',
                                        start: date,
                                        allDay: true
                                        }
                                        
                            $('#calendar').fullCalendar('renderEvent', event );
                            
                            event.start = event.start.format('YYYY-MM-DD');
                            fetch( "/app/addEvent", { body: JSON.stringify( event ), method: "POST", headers: { "Content-Type": "application/json"}});
                        } else {
                            alert('Invalid date.');
                        }
                    }
                }
            }
        });

        const fetchUrl = "http://localhost:5000/app/fetch";
        fetch(fetchUrl)
            .then((resp) => resp.json())
            .then(function(data) {
                data.forEach(element => {
                    if (element.date) {
                        let date = moment(element.date);
                        if (date.isValid()) {
                            $('#calendar').fullCalendar('renderEvent', {
                                title: element.name,
                                start: date,
                                allDay: element.allDay
                            });
                        } else {
                            alert('Invalid date.');
                        }
                    }
                });
            });
    });
</script>
</body>
</html>